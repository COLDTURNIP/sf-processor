- macro: network_flows
  condition: sf.type = NF and 
             sf.proc.cmdline contains exfil.py and
             sf.flow.wbytes > 0 and
             sf.net.dip pmatch (104.,169.)

- macro: contains_exfil
  condition: sf.type = PE and 
             sf.proc.cmdline contains exfil.py

- macro: write_exfil
  condition: sf.type = FF and 
             sf.opflags in (WRITE) and 
             sf.file.path contains exfil.py

- macro: write_by_exfil
  condition: sf.type = FF and 
             sf.opflags in (WRITE) and 
             sf.file.type = f and
             sf.proc.cmdline contains exfil.py

# - filter: filter-mode-tests
#   condition: not write_exfil

- rule: Open write
  desc: Open write
  condition: sf.type = FF and sf.file.openflags in (WRONLY, RDWR) # sf.opflags in (WRITE) #sf.file.is_open_write = true
  action: [alert]
  priority: high
  tags: [open-write]
